import org.junit.Assert;
import org.junit.Test;
import at.aau.itec.minecraft.serverstateloggingplugin.statechange.NbtDiffIterInventorySlotAndRecipeMod;

import java.util.Arrays;
import java.util.Collections;
import java.util.LinkedList;
import java.util.List;

// https://www.jetbrains.com/help/idea/configuring-testing-libraries.html
// https://www.jetbrains.com/help/idea/tdd-with-intellij-idea.html
public class NbtDiffIterInventorySlotAndRecipeModTest {

    @Test
    public void testEqual() throws Exception{
        String nbtprev = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        String nbtnext = nbtprev;
        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Assert.assertEquals(0, result.size());
    }

    @Test
    public void testPositionChange() throws Exception{
        String nbtprev = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        String nbtnext = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[447.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - Pos/[0]:446.5d", " + Pos/[0]:447.5d");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testTopLevelChange() throws Exception{
        String nbtprev = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        String nbtnext = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42157,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - Spigot.ticksLived:42147", " + Spigot.ticksLived:42157");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testTopLevelChangeIgnore() throws Exception{
        String nbtprev = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        String nbtnext = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42157,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, Arrays.asList("Spigot.ticksLived"));
        System.out.println(result);

        Assert.assertArrayEquals(new String[]{}, result.toArray());
    }

    @Test
    public void testLowerLevelArrayItemChange() throws Exception{
        String nbtprev = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188453L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        String nbtnext = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - Attributes/[5]/Modifiers/[0]/UUIDMost:-3095412869162188453L", " + Attributes/[5]/Modifiers/[0]/UUIDMost:-3095412869162188454L");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testCombinedChange() throws Exception{
        String nbtprev = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188453L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        String nbtnext = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42157,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - Attributes/[5]/Modifiers/[0]/UUIDMost:-3095412869162188453L", " + Attributes/[5]/Modifiers/[0]/UUIDMost:-3095412869162188454L", " - Spigot.ticksLived:42147", " + Spigot.ticksLived:42157");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testAddedTopLevelKey() throws Exception{
        String nbtprev = "{AgeLocked:0b,HurtByTimestamp:0,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        String nbtnext = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" + Angry:0b");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testRemovedTopLevelKey() throws Exception{
        String nbtprev = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        String nbtnext = "{AgeLocked:0b,HurtByTimestamp:0,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - Angry:0b");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testAddedLowerLevelKey() throws Exception{
        String nbtprev = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        String nbtnext = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" + Attributes/[1]/Base:0.0d");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testRemovedLowerLevelKey() throws Exception{
        String nbtprev = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        String nbtnext = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - Attributes/[1]/Base:0.0d");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testAddedListItem() throws Exception{
        String nbtprev = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        String nbtnext = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        // adding/deleting one item from the middle causes the later ones to "shift backward/forward" -> many "changes"
        Collections.sort(result);
        List<String> expected = Arrays.asList(" - Attributes/[2]/Base:0.0d", " + Attributes/[2]/Base:0.30000001192092896d", " - Attributes/[2]/Name:\"generic.armor\"", " + Attributes/[2]/Name:\"generic.movementSpeed\"", " - Attributes/[3]/Name:\"generic.armorToughness\"", " + Attributes/[3]/Name:\"generic.armor\"", " - Attributes/[4]/Base:16.0d", " + Attributes/[4]/Base:0.0d", " - Attributes/[4]/Name:\"generic.followRange\"", " + Attributes/[4]/Name:\"generic.armorToughness\"", " - Attributes/[4]/Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}]", " - Attributes/[5]/Base:4.0d", " + Attributes/[5]/Base:16.0d", " - Attributes/[5]/Name:\"generic.attackDamage\"", " + Attributes/[5]/Name:\"generic.followRange\"", " + Attributes/[5]/Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}]", " + Attributes/[6]:{Base:4.0d,Name:\"generic.attackDamage\"}");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testRemovedListItem() throws Exception{
        String nbtprev = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.30000001192092896d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";
        String nbtnext = "{AgeLocked:0b,HurtByTimestamp:0,Angry:0b,Sitting:0b,Attributes:[{Base:8.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:16.0d,Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}],Name:\"generic.followRange\"},{Base:4.0d,Name:\"generic.attackDamage\"}],Invulnerable:0b,FallFlying:0b,ForcedAge:0,PortalCooldown:0,AbsorptionAmount:0.0f,FallDistance:0.0f,InLove:0,DeathTime:0s,WorldUUIDMost:4274445143610573293L,HandDropChances:[0.085f,0.085f],PersistenceRequired:1b,Spigot.ticksLived:42147,Age:0,CollarColor:1b,Motion:[0.0d,-0.0784000015258789d,0.0d],Leashed:0b,UUIDLeast:-7796496611822457784L,Health:8.0f,Bukkit.updateLevel:2,LeftHanded:0b,Air:300s,OnGround:1b,Dimension:0,Rotation:[101.37413f,0.0f],HandItems:[{},{}],ArmorDropChances:[0.085f,0.085f,0.085f,0.085f],OwnerUUID:\"\",UUIDMost:4443869730051737981L,Pos:[446.5d,69.0d,421.5d],Fire:-1s,ArmorItems:[{},{},{},{}],CanPickUpLoot:0b,HurtTime:0s,WorldUUIDLeast:-8073140550504750389L}";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - Attributes/[2]/Base:0.30000001192092896d", " + Attributes/[2]/Base:0.0d", " - Attributes/[2]/Name:\"generic.movementSpeed\"", " + Attributes/[2]/Name:\"generic.armor\"", " - Attributes/[3]/Name:\"generic.armor\"", " + Attributes/[3]/Name:\"generic.armorToughness\"", " - Attributes/[4]/Base:0.0d", " + Attributes/[4]/Base:16.0d", " - Attributes/[4]/Name:\"generic.armorToughness\"", " + Attributes/[4]/Name:\"generic.followRange\"", " + Attributes/[4]/Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}]", " - Attributes/[5]/Base:16.0d", " + Attributes/[5]/Base:4.0d", " - Attributes/[5]/Name:\"generic.followRange\"", " + Attributes/[5]/Name:\"generic.attackDamage\"", " - Attributes/[5]/Modifiers:[{UUIDMost:-3095412869162188454L,UUIDLeast:-6283034937680631004L,Amount:0.055668478091697275d,Operation:1,Name:\"Random spawn bonus\"}]", " - Attributes/[6]:{Base:4.0d,Name:\"generic.attackDamage\"}");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerComparison() throws Exception{
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1537295623340L,lastKnownName:\"bla\",keepLevel:0b,expToDrop:0,lastPlayed:1539680452912L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:1b,mayfly:1b,instabuild:1b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isGuiOpen:0b},DeathTime:0s,XpSeed:942738183,WorldUUIDMost:4274445143610573293L,XpTotal:11,playerGameType:1,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Glowing:1b,Rotation:[-8.552621f,32.09997f],XpLevel:1,Score:71,UUIDMost:1956384011718905599L,CustomName:\"sdfsadfsadfsafd\",Sleeping:0b,Pos:[192.92120281154197d,63.0d,743.9976793001044d],Fire:-20s,XpP:0.44444448f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:3,SpawnWorld:\"world\",WorldUUIDLeast:-8073140550504750389L,Inventory:[{Slot:0b,id:\"minecraft:porkchop\",Count:8b,Damage:0s},{Slot:1b,id:\"minecraft:wheat_seeds\",Count:1b,Damage:0s},{Slot:2b,id:\"minecraft:egg\",Count:2b,Damage:0s},{Slot:3b,id:\"minecraft:dirt\",Count:1b,Damage:0s},{Slot:4b,id:\"minecraft:log\",Count:12b,Damage:0s},{Slot:5b,id:\"minecraft:cooked_porkchop\",Count:2b,Damage:0s},{Slot:19b,id:\"minecraft:porkchop\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:porkchop\",Count:2b,Damage:0s},{Slot:31b,id:\"minecraft:log\",Count:6b,Damage:0s},{Slot:33b,id:\"minecraft:log\",Count:3b,Damage:0s},{Slot:34b,id:\"minecraft:sapling\",Count:2b,Damage:0s},{Slot:35b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}\n";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1537295623340L,lastKnownName:\"bla\",keepLevel:0b,expToDrop:0,lastPlayed:1539680453437L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:1b,mayfly:1b,instabuild:1b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isGuiOpen:0b},DeathTime:0s,XpSeed:942738183,WorldUUIDMost:4274445143610573293L,XpTotal:11,playerGameType:1,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Glowing:1b,Rotation:[-11.25262f,31.949972f],XpLevel:1,Score:71,UUIDMost:1956384011718905599L,CustomName:\"sdfsadfsadfsafd\",Sleeping:0b,Pos:[192.1727576877097d,63.0d,745.2756819607715d],Fire:-20s,XpP:0.44444448f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:3,SpawnWorld:\"world\",WorldUUIDLeast:-8073140550504750389L,Inventory:[{Slot:0b,id:\"minecraft:porkchop\",Count:8b,Damage:0s},{Slot:1b,id:\"minecraft:wheat_seeds\",Count:1b,Damage:0s},{Slot:2b,id:\"minecraft:egg\",Count:2b,Damage:0s},{Slot:3b,id:\"minecraft:dirt\",Count:1b,Damage:0s},{Slot:4b,id:\"minecraft:log\",Count:12b,Damage:0s},{Slot:5b,id:\"minecraft:cooked_porkchop\",Count:2b,Damage:0s},{Slot:19b,id:\"minecraft:porkchop\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:porkchop\",Count:2b,Damage:0s},{Slot:31b,id:\"minecraft:log\",Count:6b,Damage:0s},{Slot:33b,id:\"minecraft:log\",Count:3b,Damage:0s},{Slot:34b,id:\"minecraft:sapling\",Count:2b,Damage:0s},{Slot:35b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}\n";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - bukkit/lastPlayed:1539680452912L", " + bukkit/lastPlayed:1539680453437L", " - Rotation/[0]:-8.552621f", " + Rotation/[0]:-11.25262f", " - Rotation/[1]:32.09997f", " + Rotation/[1]:31.949972f", " - Pos/[0]:192.92120281154197d", " + Pos/[0]:192.1727576877097d", " - Pos/[2]:743.9976793001044d", " + Pos/[2]:745.2756819607715d");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerInventoryChange() throws Exception{
        // testing multiple changes to a player nbt
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1537295623340L,lastKnownName:\"bla\",keepLevel:0b,expToDrop:0,lastPlayed:1539680449946L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:1b,mayfly:1b,instabuild:1b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isGuiOpen:0b},DeathTime:0s,XpSeed:942738183,WorldUUIDMost:4274445143610573293L,XpTotal:11,playerGameType:1,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Glowing:1b,Rotation:[-74.70262f,41.399982f],XpLevel:1,Score:71,UUIDMost:1956384011718905599L,CustomName:\"sdfsadfsadfsafd\",Sleeping:0b,Pos:[193.8193816502897d,63.0d,742.5563486838325d],Fire:-20s,XpP:0.44444448f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:3,SpawnWorld:\"world\",WorldUUIDLeast:-8073140550504750389L,Inventory:[{Slot:0b,id:\"minecraft:porkchop\",Count:8b,Damage:0s},{Slot:1b,id:\"minecraft:wheat_seeds\",Count:1b,Damage:0s},{Slot:2b,id:\"minecraft:egg\",Count:2b,Damage:0s},{Slot:3b,id:\"minecraft:dirt\",Count:1b,Damage:0s},{Slot:4b,id:\"minecraft:log\",Count:12b,Damage:0s},{Slot:19b,id:\"minecraft:porkchop\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:porkchop\",Count:2b,Damage:0s},{Slot:31b,id:\"minecraft:log\",Count:6b,Damage:0s},{Slot:33b,id:\"minecraft:log\",Count:3b,Damage:0s},{Slot:34b,id:\"minecraft:sapling\",Count:2b,Damage:0s},{Slot:35b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}\n";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1537295623340L,lastKnownName:\"bla\",keepLevel:0b,expToDrop:0,lastPlayed:1539680452912L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:1b,mayfly:1b,instabuild:1b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isGuiOpen:0b},DeathTime:0s,XpSeed:942738183,WorldUUIDMost:4274445143610573293L,XpTotal:11,playerGameType:1,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Glowing:1b,Rotation:[-8.552621f,32.09997f],XpLevel:1,Score:71,UUIDMost:1956384011718905599L,CustomName:\"sdfsadfsadfsafd\",Sleeping:0b,Pos:[192.92120281154197d,63.0d,743.9976793001044d],Fire:-20s,XpP:0.44444448f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:3,SpawnWorld:\"world\",WorldUUIDLeast:-8073140550504750389L,Inventory:[{Slot:0b,id:\"minecraft:porkchop\",Count:8b,Damage:0s},{Slot:1b,id:\"minecraft:wheat_seeds\",Count:1b,Damage:0s},{Slot:2b,id:\"minecraft:egg\",Count:2b,Damage:0s},{Slot:3b,id:\"minecraft:dirt\",Count:1b,Damage:0s},{Slot:4b,id:\"minecraft:log\",Count:12b,Damage:0s},{Slot:5b,id:\"minecraft:cooked_porkchop\",Count:2b,Damage:0s},{Slot:19b,id:\"minecraft:porkchop\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:porkchop\",Count:2b,Damage:0s},{Slot:31b,id:\"minecraft:log\",Count:6b,Damage:0s},{Slot:33b,id:\"minecraft:log\",Count:3b,Damage:0s},{Slot:34b,id:\"minecraft:sapling\",Count:2b,Damage:0s},{Slot:35b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}\n";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - bukkit/lastPlayed:1539680449946L", " + bukkit/lastPlayed:1539680452912L", " + Inventory/Slot:5b:{Slot:5b,id:\"minecraft:cooked_porkchop\",Count:2b,Damage:0s}", " - Rotation/[0]:-74.70262f", " + Rotation/[0]:-8.552621f", " - Rotation/[1]:41.399982f", " + Rotation/[1]:32.09997f", " - Pos/[0]:193.8193816502897d", " + Pos/[0]:192.92120281154197d", " - Pos/[2]:742.5563486838325d", " + Pos/[2]:743.9976793001044d");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerInventoryChangeAdd() throws Exception{
        // adding a slot-entry to the inventory
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1537295623340L,lastKnownName:\"bla\",keepLevel:0b,expToDrop:0,lastPlayed:1539680452912L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:1b,mayfly:1b,instabuild:1b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isGuiOpen:0b},DeathTime:0s,XpSeed:942738183,WorldUUIDMost:4274445143610573293L,XpTotal:11,playerGameType:1,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Glowing:1b,Rotation:[-8.552621f,32.09997f],XpLevel:1,Score:71,UUIDMost:1956384011718905599L,CustomName:\"sdfsadfsadfsafd\",Sleeping:0b,Pos:[192.92120281154197d,63.0d,743.9976793001044d],Fire:-20s,XpP:0.44444448f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:3,SpawnWorld:\"world\",WorldUUIDLeast:-8073140550504750389L,Inventory:[{Slot:0b,id:\"minecraft:porkchop\",Count:8b,Damage:0s},{Slot:1b,id:\"minecraft:wheat_seeds\",Count:1b,Damage:0s},{Slot:2b,id:\"minecraft:egg\",Count:2b,Damage:0s},{Slot:3b,id:\"minecraft:dirt\",Count:1b,Damage:0s},{Slot:4b,id:\"minecraft:log\",Count:12b,Damage:0s},{Slot:19b,id:\"minecraft:porkchop\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:porkchop\",Count:2b,Damage:0s},{Slot:31b,id:\"minecraft:log\",Count:6b,Damage:0s},{Slot:33b,id:\"minecraft:log\",Count:3b,Damage:0s},{Slot:34b,id:\"minecraft:sapling\",Count:2b,Damage:0s},{Slot:35b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}\n";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1537295623340L,lastKnownName:\"bla\",keepLevel:0b,expToDrop:0,lastPlayed:1539680452912L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:1b,mayfly:1b,instabuild:1b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isGuiOpen:0b},DeathTime:0s,XpSeed:942738183,WorldUUIDMost:4274445143610573293L,XpTotal:11,playerGameType:1,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Glowing:1b,Rotation:[-8.552621f,32.09997f],XpLevel:1,Score:71,UUIDMost:1956384011718905599L,CustomName:\"sdfsadfsadfsafd\",Sleeping:0b,Pos:[192.92120281154197d,63.0d,743.9976793001044d],Fire:-20s,XpP:0.44444448f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:3,SpawnWorld:\"world\",WorldUUIDLeast:-8073140550504750389L,Inventory:[{Slot:0b,id:\"minecraft:porkchop\",Count:8b,Damage:0s},{Slot:1b,id:\"minecraft:wheat_seeds\",Count:1b,Damage:0s},{Slot:2b,id:\"minecraft:egg\",Count:2b,Damage:0s},{Slot:3b,id:\"minecraft:dirt\",Count:1b,Damage:0s},{Slot:4b,id:\"minecraft:log\",Count:12b,Damage:0s},{Slot:5b,id:\"minecraft:cooked_porkchop\",Count:2b,Damage:0s},{Slot:19b,id:\"minecraft:porkchop\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:porkchop\",Count:2b,Damage:0s},{Slot:31b,id:\"minecraft:log\",Count:6b,Damage:0s},{Slot:33b,id:\"minecraft:log\",Count:3b,Damage:0s},{Slot:34b,id:\"minecraft:sapling\",Count:2b,Damage:0s},{Slot:35b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}\n";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" + Inventory/Slot:5b:{Slot:5b,id:\"minecraft:cooked_porkchop\",Count:2b,Damage:0s}");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerInventoryChangeRemove() throws Exception{
        // removing a slot-entry from the inventory
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1537295623340L,lastKnownName:\"bla\",keepLevel:0b,expToDrop:0,lastPlayed:1539680452912L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:1b,mayfly:1b,instabuild:1b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isGuiOpen:0b},DeathTime:0s,XpSeed:942738183,WorldUUIDMost:4274445143610573293L,XpTotal:11,playerGameType:1,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Glowing:1b,Rotation:[-8.552621f,32.09997f],XpLevel:1,Score:71,UUIDMost:1956384011718905599L,CustomName:\"sdfsadfsadfsafd\",Sleeping:0b,Pos:[192.92120281154197d,63.0d,743.9976793001044d],Fire:-20s,XpP:0.44444448f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:3,SpawnWorld:\"world\",WorldUUIDLeast:-8073140550504750389L,Inventory:[{Slot:0b,id:\"minecraft:porkchop\",Count:8b,Damage:0s},{Slot:1b,id:\"minecraft:wheat_seeds\",Count:1b,Damage:0s},{Slot:2b,id:\"minecraft:egg\",Count:2b,Damage:0s},{Slot:3b,id:\"minecraft:dirt\",Count:1b,Damage:0s},{Slot:4b,id:\"minecraft:log\",Count:12b,Damage:0s},{Slot:5b,id:\"minecraft:cooked_porkchop\",Count:2b,Damage:0s},{Slot:19b,id:\"minecraft:porkchop\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:porkchop\",Count:2b,Damage:0s},{Slot:31b,id:\"minecraft:log\",Count:6b,Damage:0s},{Slot:33b,id:\"minecraft:log\",Count:3b,Damage:0s},{Slot:34b,id:\"minecraft:sapling\",Count:2b,Damage:0s},{Slot:35b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}\n";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1537295623340L,lastKnownName:\"bla\",keepLevel:0b,expToDrop:0,lastPlayed:1539680452912L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:1b,mayfly:1b,instabuild:1b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isGuiOpen:0b},DeathTime:0s,XpSeed:942738183,WorldUUIDMost:4274445143610573293L,XpTotal:11,playerGameType:1,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Glowing:1b,Rotation:[-8.552621f,32.09997f],XpLevel:1,Score:71,UUIDMost:1956384011718905599L,CustomName:\"sdfsadfsadfsafd\",Sleeping:0b,Pos:[192.92120281154197d,63.0d,743.9976793001044d],Fire:-20s,XpP:0.44444448f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:3,SpawnWorld:\"world\",WorldUUIDLeast:-8073140550504750389L,Inventory:[{Slot:0b,id:\"minecraft:porkchop\",Count:8b,Damage:0s},{Slot:1b,id:\"minecraft:wheat_seeds\",Count:1b,Damage:0s},{Slot:2b,id:\"minecraft:egg\",Count:2b,Damage:0s},{Slot:3b,id:\"minecraft:dirt\",Count:1b,Damage:0s},{Slot:4b,id:\"minecraft:log\",Count:12b,Damage:0s},{Slot:19b,id:\"minecraft:porkchop\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:porkchop\",Count:2b,Damage:0s},{Slot:31b,id:\"minecraft:log\",Count:6b,Damage:0s},{Slot:33b,id:\"minecraft:log\",Count:3b,Damage:0s},{Slot:34b,id:\"minecraft:sapling\",Count:2b,Damage:0s},{Slot:35b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}\n";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - Inventory/Slot:5b:{Slot:5b,id:\"minecraft:cooked_porkchop\",Count:2b,Damage:0s}");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerInventoryChangeCount() throws Exception{
        // changing the count of an item in the inventory
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1537295623340L,lastKnownName:\"bla\",keepLevel:0b,expToDrop:0,lastPlayed:1539680452912L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:1b,mayfly:1b,instabuild:1b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isGuiOpen:0b},DeathTime:0s,XpSeed:942738183,WorldUUIDMost:4274445143610573293L,XpTotal:11,playerGameType:1,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Glowing:1b,Rotation:[-8.552621f,32.09997f],XpLevel:1,Score:71,UUIDMost:1956384011718905599L,CustomName:\"sdfsadfsadfsafd\",Sleeping:0b,Pos:[192.92120281154197d,63.0d,743.9976793001044d],Fire:-20s,XpP:0.44444448f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:3,SpawnWorld:\"world\",WorldUUIDLeast:-8073140550504750389L,Inventory:[{Slot:0b,id:\"minecraft:porkchop\",Count:8b,Damage:0s},{Slot:1b,id:\"minecraft:wheat_seeds\",Count:1b,Damage:0s},{Slot:2b,id:\"minecraft:egg\",Count:2b,Damage:0s},{Slot:3b,id:\"minecraft:dirt\",Count:1b,Damage:0s},{Slot:4b,id:\"minecraft:log\",Count:12b,Damage:0s},{Slot:5b,id:\"minecraft:cooked_porkchop\",Count:2b,Damage:0s},{Slot:19b,id:\"minecraft:porkchop\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:porkchop\",Count:2b,Damage:0s},{Slot:31b,id:\"minecraft:log\",Count:6b,Damage:0s},{Slot:33b,id:\"minecraft:log\",Count:3b,Damage:0s},{Slot:34b,id:\"minecraft:sapling\",Count:2b,Damage:0s},{Slot:35b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}\n";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1537295623340L,lastKnownName:\"bla\",keepLevel:0b,expToDrop:0,lastPlayed:1539680452912L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:1b,mayfly:1b,instabuild:1b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isGuiOpen:0b},DeathTime:0s,XpSeed:942738183,WorldUUIDMost:4274445143610573293L,XpTotal:11,playerGameType:1,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Glowing:1b,Rotation:[-8.552621f,32.09997f],XpLevel:1,Score:71,UUIDMost:1956384011718905599L,CustomName:\"sdfsadfsadfsafd\",Sleeping:0b,Pos:[192.92120281154197d,63.0d,743.9976793001044d],Fire:-20s,XpP:0.44444448f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:3,SpawnWorld:\"world\",WorldUUIDLeast:-8073140550504750389L,Inventory:[{Slot:0b,id:\"minecraft:porkchop\",Count:8b,Damage:0s},{Slot:1b,id:\"minecraft:wheat_seeds\",Count:1b,Damage:0s},{Slot:2b,id:\"minecraft:egg\",Count:2b,Damage:0s},{Slot:3b,id:\"minecraft:dirt\",Count:1b,Damage:0s},{Slot:4b,id:\"minecraft:log\",Count:12b,Damage:0s},{Slot:5b,id:\"minecraft:cooked_porkchop\",Count:3b,Damage:0s},{Slot:19b,id:\"minecraft:porkchop\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:porkchop\",Count:2b,Damage:0s},{Slot:31b,id:\"minecraft:log\",Count:6b,Damage:0s},{Slot:33b,id:\"minecraft:log\",Count:3b,Damage:0s},{Slot:34b,id:\"minecraft:sapling\",Count:2b,Damage:0s},{Slot:35b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}\n";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - Inventory/Slot:5b/Count:2b", " + Inventory/Slot:5b/Count:3b");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerInventoryChangeReorder() throws Exception{
        // just reordering items in Inventory list, no change expected
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1537295623340L,lastKnownName:\"bla\",keepLevel:0b,expToDrop:0,lastPlayed:1539680452912L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:1b,mayfly:1b,instabuild:1b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isGuiOpen:0b},DeathTime:0s,XpSeed:942738183,WorldUUIDMost:4274445143610573293L,XpTotal:11,playerGameType:1,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Glowing:1b,Rotation:[-8.552621f,32.09997f],XpLevel:1,Score:71,UUIDMost:1956384011718905599L,CustomName:\"sdfsadfsadfsafd\",Sleeping:0b,Pos:[192.92120281154197d,63.0d,743.9976793001044d],Fire:-20s,XpP:0.44444448f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:3,SpawnWorld:\"world\",WorldUUIDLeast:-8073140550504750389L,Inventory:[{Slot:0b,id:\"minecraft:porkchop\",Count:8b,Damage:0s},{Slot:1b,id:\"minecraft:wheat_seeds\",Count:1b,Damage:0s},{Slot:2b,id:\"minecraft:egg\",Count:2b,Damage:0s},{Slot:3b,id:\"minecraft:dirt\",Count:1b,Damage:0s},{Slot:5b,id:\"minecraft:cooked_porkchop\",Count:2b,Damage:0s},{Slot:4b,id:\"minecraft:log\",Count:12b,Damage:0s},{Slot:19b,id:\"minecraft:porkchop\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:porkchop\",Count:2b,Damage:0s},{Slot:31b,id:\"minecraft:log\",Count:6b,Damage:0s},{Slot:33b,id:\"minecraft:log\",Count:3b,Damage:0s},{Slot:34b,id:\"minecraft:sapling\",Count:2b,Damage:0s},{Slot:35b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}\n";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1537295623340L,lastKnownName:\"bla\",keepLevel:0b,expToDrop:0,lastPlayed:1539680452912L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:1b,mayfly:1b,instabuild:1b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:yellow_concrete_powder\",\"minecraft:white_concrete_powder\",\"minecraft:spruce_planks\",\"minecraft:spruce_boat\",\"minecraft:sandstone\",\"minecraft:red_dye_from_poppy\",\"minecraft:red_concrete_powder\",\"minecraft:purple_concrete_powder\",\"minecraft:pink_concrete_powder\",\"minecraft:orange_concrete_powder\",\"minecraft:oak_planks\",\"minecraft:magenta_concrete_powder\",\"minecraft:lime_concrete_powder\",\"minecraft:light_gray_concrete_powder\",\"minecraft:light_blue_concrete_powder\",\"minecraft:jungle_boat\",\"minecraft:green_concrete_powder\",\"minecraft:gray_concrete_powder\",\"minecraft:dark_oak_boat\",\"minecraft:cyan_concrete_powder\",\"minecraft:chest\",\"minecraft:cake\",\"minecraft:brown_concrete_powder\",\"minecraft:boat\",\"minecraft:blue_concrete_powder\",\"minecraft:black_concrete_powder\",\"minecraft:birch_boat\",\"minecraft:acacia_boat\"],isGuiOpen:0b},DeathTime:0s,XpSeed:942738183,WorldUUIDMost:4274445143610573293L,XpTotal:11,playerGameType:1,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Glowing:1b,Rotation:[-8.552621f,32.09997f],XpLevel:1,Score:71,UUIDMost:1956384011718905599L,CustomName:\"sdfsadfsadfsafd\",Sleeping:0b,Pos:[192.92120281154197d,63.0d,743.9976793001044d],Fire:-20s,XpP:0.44444448f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:3,SpawnWorld:\"world\",WorldUUIDLeast:-8073140550504750389L,Inventory:[{Slot:0b,id:\"minecraft:porkchop\",Count:8b,Damage:0s},{Slot:1b,id:\"minecraft:wheat_seeds\",Count:1b,Damage:0s},{Slot:2b,id:\"minecraft:egg\",Count:2b,Damage:0s},{Slot:3b,id:\"minecraft:dirt\",Count:1b,Damage:0s},{Slot:4b,id:\"minecraft:log\",Count:12b,Damage:0s},{Slot:5b,id:\"minecraft:cooked_porkchop\",Count:2b,Damage:0s},{Slot:19b,id:\"minecraft:porkchop\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:porkchop\",Count:2b,Damage:0s},{Slot:31b,id:\"minecraft:log\",Count:6b,Damage:0s},{Slot:33b,id:\"minecraft:log\",Count:3b,Damage:0s},{Slot:34b,id:\"minecraft:sapling\",Count:2b,Damage:0s},{Slot:35b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}\n";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList();
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerAddRecipes() throws Exception{
        // test fixture, just test changes to recipeBook
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068314762L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[],isFilteringCraftable:0b,toBeDisplayed:[],isGuiOpen:0b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[4.769209f,0.0f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[86.5d,71.0d,256.5d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[],foodTickTimer:0}";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068314762L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:oak_planks\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:oak_planks\"],isGuiOpen:0b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[4.769209f,0.0f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[86.5d,71.0d,256.5d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[],foodTickTimer:0}\n";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" + recipeBook/recipes/minecraft:oak_planks", " + recipeBook/toBeDisplayed/minecraft:oak_planks");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerRemoveRecipes() throws Exception{
        // test fixture, just test changes to recipeBook
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068314762L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:oak_planks\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:oak_planks\"],isGuiOpen:0b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[4.769209f,0.0f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[86.5d,71.0d,256.5d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[],foodTickTimer:0}\n";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068314762L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[],isFilteringCraftable:0b,toBeDisplayed:[],isGuiOpen:0b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[4.769209f,0.0f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[86.5d,71.0d,256.5d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[],foodTickTimer:0}";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - recipeBook/recipes/minecraft:oak_planks", " - recipeBook/toBeDisplayed/minecraft:oak_planks");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerEqualRecipes() throws Exception{
        // test fixture, just test changes to recipeBook
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068314762L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:oak_planks\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:oak_planks\"],isGuiOpen:0b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[4.769209f,0.0f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[86.5d,71.0d,256.5d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[],foodTickTimer:0}\n";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068314762L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:oak_planks\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:oak_planks\"],isGuiOpen:0b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[4.769209f,0.0f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[86.5d,71.0d,256.5d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[],foodTickTimer:0}\n";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList();
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerRecipeChanges1() throws Exception{
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068314762L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[],isFilteringCraftable:0b,toBeDisplayed:[],isGuiOpen:0b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[4.769209f,0.0f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[86.5d,71.0d,256.5d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.0f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[],foodTickTimer:0}";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068335701L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:oak_planks\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:oak_planks\"],isGuiOpen:0b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[-99.93082f,21.300018f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[97.91647528637812d,69.0d,252.44236838796445d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.01f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[{Slot:0b,id:\"minecraft:log\",Count:2b,Damage:0s}],foodTickTimer:0}";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - foodExhaustionLevel:0.0f", " + foodExhaustionLevel:0.01f", " - bukkit/lastPlayed:1541068314762L", " + bukkit/lastPlayed:1541068335701L", " + recipeBook/recipes/minecraft:oak_planks", " + recipeBook/toBeDisplayed/minecraft:oak_planks", " - Rotation/[0]:4.769209f", " + Rotation/[0]:-99.93082f", " - Rotation/[1]:0.0f", " + Rotation/[1]:21.300018f", " - Pos/[0]:86.5d", " + Pos/[0]:97.91647528637812d", " - Pos/[1]:71.0d", " + Pos/[1]:69.0d", " - Pos/[2]:256.5d", " + Pos/[2]:252.44236838796445d", " + Inventory/[0]:{Slot:0b,id:\"minecraft:log\",Count:2b,Damage:0s}");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerRecipeChanges2() throws Exception{
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068335701L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:oak_planks\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:oak_planks\"],isGuiOpen:0b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[-99.93082f,21.300018f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[97.91647528637812d,69.0d,252.44236838796445d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.01f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[{Slot:0b,id:\"minecraft:log\",Count:2b,Damage:0s}],foodTickTimer:0}";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068342861L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:wooden_pressure_plate\",\"minecraft:wooden_door\",\"minecraft:wooden_button\",\"minecraft:trapdoor\",\"minecraft:stick\",\"minecraft:sign\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:oak_planks\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:crafting_table\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:wooden_pressure_plate\",\"minecraft:wooden_door\",\"minecraft:wooden_button\",\"minecraft:trapdoor\",\"minecraft:stick\",\"minecraft:sign\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:oak_planks\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:crafting_table\"],isGuiOpen:0b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[-272.88077f,21.150007f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[92.52543569704686d,69.0d,254.41497603283773d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.01f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[{Slot:14b,id:\"minecraft:planks\",Count:4b,Damage:0s}],foodTickTimer:0}";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - bukkit/lastPlayed:1541068335701L", " + bukkit/lastPlayed:1541068342861L", " + recipeBook/recipes/minecraft:crafting_table", " + recipeBook/recipes/minecraft:wooden_door", " + recipeBook/recipes/minecraft:trapdoor", " + recipeBook/recipes/minecraft:oak_wooden_slab", " + recipeBook/recipes/minecraft:wooden_pressure_plate", " + recipeBook/recipes/minecraft:wooden_button", " + recipeBook/recipes/minecraft:sign", " + recipeBook/recipes/minecraft:stick", " + recipeBook/recipes/minecraft:fence", " + recipeBook/recipes/minecraft:oak_stairs", " + recipeBook/recipes/minecraft:fence_gate", " + recipeBook/toBeDisplayed/minecraft:crafting_table", " + recipeBook/toBeDisplayed/minecraft:wooden_door", " + recipeBook/toBeDisplayed/minecraft:trapdoor", " + recipeBook/toBeDisplayed/minecraft:oak_wooden_slab", " + recipeBook/toBeDisplayed/minecraft:wooden_pressure_plate", " + recipeBook/toBeDisplayed/minecraft:wooden_button", " + recipeBook/toBeDisplayed/minecraft:sign", " + recipeBook/toBeDisplayed/minecraft:stick", " + recipeBook/toBeDisplayed/minecraft:fence", " + recipeBook/toBeDisplayed/minecraft:oak_stairs", " + recipeBook/toBeDisplayed/minecraft:fence_gate", " - Inventory/Slot:0b:{Slot:0b,id:\"minecraft:log\",Count:2b,Damage:0s}", " + Inventory/Slot:14b:{Slot:14b,id:\"minecraft:planks\",Count:4b,Damage:0s}", " - Rotation/[0]:-99.93082f", " + Rotation/[0]:-272.88077f", " - Rotation/[1]:21.300018f", " + Rotation/[1]:21.150007f", " - Pos/[0]:97.91647528637812d", " + Pos/[0]:92.52543569704686d", " - Pos/[2]:252.44236838796445d", " + Pos/[2]:254.41497603283773d");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerRecipeChanges3() throws Exception{
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068342861L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:wooden_pressure_plate\",\"minecraft:wooden_door\",\"minecraft:wooden_button\",\"minecraft:trapdoor\",\"minecraft:stick\",\"minecraft:sign\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:oak_planks\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:crafting_table\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:wooden_pressure_plate\",\"minecraft:wooden_door\",\"minecraft:wooden_button\",\"minecraft:trapdoor\",\"minecraft:stick\",\"minecraft:sign\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:oak_planks\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:crafting_table\"],isGuiOpen:0b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[-272.88077f,21.150007f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[92.52543569704686d,69.0d,254.41497603283773d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.01f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[{Slot:14b,id:\"minecraft:planks\",Count:4b,Damage:0s}],foodTickTimer:0}";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068345416L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:wooden_pressure_plate\",\"minecraft:wooden_door\",\"minecraft:wooden_button\",\"minecraft:trapdoor\",\"minecraft:stick\",\"minecraft:sign\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:oak_planks\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:crafting_table\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:wooden_door\",\"minecraft:trapdoor\",\"minecraft:sign\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:fence_gate\",\"minecraft:fence\"],isGuiOpen:1b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[-272.88077f,21.150007f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[92.52543569704686d,69.0d,254.41497603283773d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.01f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[{Slot:14b,id:\"minecraft:planks\",Count:4b,Damage:0s},{Slot:24b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - bukkit/lastPlayed:1541068342861L", " + bukkit/lastPlayed:1541068345416L", " - recipeBook/toBeDisplayed/minecraft:crafting_table", " - recipeBook/toBeDisplayed/minecraft:wooden_pressure_plate", " - recipeBook/toBeDisplayed/minecraft:wooden_button", " - recipeBook/toBeDisplayed/minecraft:stick", " - recipeBook/toBeDisplayed/minecraft:oak_planks", " - recipeBook/isGuiOpen:0b", " + recipeBook/isGuiOpen:1b", " + Inventory/Slot:24b:{Slot:24b,id:\"minecraft:log\",Count:1b,Damage:0s}");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerRecipeChanges4() throws Exception{
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068345416L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:wooden_pressure_plate\",\"minecraft:wooden_door\",\"minecraft:wooden_button\",\"minecraft:trapdoor\",\"minecraft:stick\",\"minecraft:sign\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:oak_planks\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:crafting_table\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:wooden_door\",\"minecraft:trapdoor\",\"minecraft:sign\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:fence_gate\",\"minecraft:fence\"],isGuiOpen:1b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[-272.88077f,21.150007f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[92.52543569704686d,69.0d,254.41497603283773d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.01f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[{Slot:14b,id:\"minecraft:planks\",Count:4b,Damage:0s},{Slot:24b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068348456L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:wooden_sword\",\"minecraft:wooden_shovel\",\"minecraft:wooden_pressure_plate\",\"minecraft:wooden_pickaxe\",\"minecraft:wooden_hoe\",\"minecraft:wooden_door\",\"minecraft:wooden_button\",\"minecraft:wooden_axe\",\"minecraft:trapdoor\",\"minecraft:stick\",\"minecraft:sign\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:oak_planks\",\"minecraft:ladder\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:crafting_table\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:wooden_sword\",\"minecraft:wooden_shovel\",\"minecraft:wooden_pickaxe\",\"minecraft:wooden_hoe\",\"minecraft:wooden_door\",\"minecraft:wooden_axe\",\"minecraft:trapdoor\",\"minecraft:sign\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:ladder\",\"minecraft:fence_gate\",\"minecraft:fence\"],isGuiOpen:1b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[-272.88077f,21.150007f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[92.52543569704686d,69.0d,254.41497603283773d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.01f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[{Slot:14b,id:\"minecraft:planks\",Count:2b,Damage:0s},{Slot:21b,id:\"minecraft:stick\",Count:4b,Damage:0s},{Slot:24b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - bukkit/lastPlayed:1541068345416L", " + bukkit/lastPlayed:1541068348456L", " + recipeBook/recipes/minecraft:wooden_axe", " + recipeBook/recipes/minecraft:wooden_shovel", " + recipeBook/recipes/minecraft:ladder", " + recipeBook/recipes/minecraft:wooden_pickaxe", " + recipeBook/recipes/minecraft:wooden_sword", " + recipeBook/recipes/minecraft:wooden_hoe", " + recipeBook/toBeDisplayed/minecraft:wooden_axe", " + recipeBook/toBeDisplayed/minecraft:wooden_shovel", " + recipeBook/toBeDisplayed/minecraft:ladder", " + recipeBook/toBeDisplayed/minecraft:wooden_pickaxe", " + recipeBook/toBeDisplayed/minecraft:wooden_sword", " + recipeBook/toBeDisplayed/minecraft:wooden_hoe", " + Inventory/Slot:21b:{Slot:21b,id:\"minecraft:stick\",Count:4b,Damage:0s}", " - Inventory/Slot:14b/Count:4b", " + Inventory/Slot:14b/Count:2b");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerRecipeChanges5() throws Exception{
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068348456L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:wooden_sword\",\"minecraft:wooden_shovel\",\"minecraft:wooden_pressure_plate\",\"minecraft:wooden_pickaxe\",\"minecraft:wooden_hoe\",\"minecraft:wooden_door\",\"minecraft:wooden_button\",\"minecraft:wooden_axe\",\"minecraft:trapdoor\",\"minecraft:stick\",\"minecraft:sign\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:oak_planks\",\"minecraft:ladder\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:crafting_table\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:wooden_sword\",\"minecraft:wooden_shovel\",\"minecraft:wooden_pickaxe\",\"minecraft:wooden_hoe\",\"minecraft:wooden_door\",\"minecraft:wooden_axe\",\"minecraft:trapdoor\",\"minecraft:sign\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:ladder\",\"minecraft:fence_gate\",\"minecraft:fence\"],isGuiOpen:1b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[-272.88077f,21.150007f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[92.52543569704686d,69.0d,254.41497603283773d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.01f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[{Slot:14b,id:\"minecraft:planks\",Count:2b,Damage:0s},{Slot:21b,id:\"minecraft:stick\",Count:4b,Damage:0s},{Slot:24b,id:\"minecraft:log\",Count:1b,Damage:0s}],foodTickTimer:0}";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068378588L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:wooden_sword\",\"minecraft:wooden_shovel\",\"minecraft:wooden_pressure_plate\",\"minecraft:wooden_pickaxe\",\"minecraft:wooden_hoe\",\"minecraft:wooden_door\",\"minecraft:wooden_button\",\"minecraft:wooden_axe\",\"minecraft:trapdoor\",\"minecraft:stick\",\"minecraft:sign\",\"minecraft:shield\",\"minecraft:shears\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:oak_planks\",\"minecraft:minecart\",\"minecraft:ladder\",\"minecraft:iron_trapdoor\",\"minecraft:iron_sword\",\"minecraft:iron_shovel\",\"minecraft:iron_pickaxe\",\"minecraft:iron_nugget\",\"minecraft:iron_leggings\",\"minecraft:iron_hoe\",\"minecraft:iron_helmet\",\"minecraft:iron_door\",\"minecraft:iron_chestplate\",\"minecraft:iron_boots\",\"minecraft:iron_bars\",\"minecraft:iron_axe\",\"minecraft:hopper\",\"minecraft:heavy_weighted_pressure_plate\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:crafting_table\",\"minecraft:bucket\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:wooden_sword\",\"minecraft:wooden_shovel\",\"minecraft:wooden_pickaxe\",\"minecraft:wooden_hoe\",\"minecraft:wooden_door\",\"minecraft:wooden_axe\",\"minecraft:trapdoor\",\"minecraft:sign\",\"minecraft:shield\",\"minecraft:shears\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:minecart\",\"minecraft:ladder\",\"minecraft:iron_trapdoor\",\"minecraft:iron_sword\",\"minecraft:iron_shovel\",\"minecraft:iron_pickaxe\",\"minecraft:iron_nugget\",\"minecraft:iron_leggings\",\"minecraft:iron_hoe\",\"minecraft:iron_helmet\",\"minecraft:iron_door\",\"minecraft:iron_chestplate\",\"minecraft:iron_boots\",\"minecraft:iron_bars\",\"minecraft:iron_axe\",\"minecraft:hopper\",\"minecraft:heavy_weighted_pressure_plate\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:bucket\"],isGuiOpen:1b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[-37.680817f,31.050005f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[92.52543569704686d,69.0d,254.41497603283773d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.01f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[{Slot:0b,id:\"minecraft:iron_ingot\",Count:2b,Damage:0s},{Slot:13b,id:\"minecraft:wooden_button\",Count:1b,Damage:0s},{Slot:14b,id:\"minecraft:planks\",Count:1b,Damage:0s},{Slot:16b,id:\"minecraft:planks\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:stick\",Count:4b,Damage:0s}],foodTickTimer:0}";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - bukkit/lastPlayed:1541068348456L", " + bukkit/lastPlayed:1541068378588L", " + recipeBook/recipes/minecraft:iron_chestplate", " + recipeBook/recipes/minecraft:shield", " + recipeBook/recipes/minecraft:iron_leggings", " + recipeBook/recipes/minecraft:iron_sword", " + recipeBook/recipes/minecraft:shears", " + recipeBook/recipes/minecraft:iron_bars", " + recipeBook/recipes/minecraft:bucket", " + recipeBook/recipes/minecraft:iron_helmet", " + recipeBook/recipes/minecraft:iron_trapdoor", " + recipeBook/recipes/minecraft:hopper", " + recipeBook/recipes/minecraft:iron_hoe", " + recipeBook/recipes/minecraft:iron_nugget", " + recipeBook/recipes/minecraft:iron_axe", " + recipeBook/recipes/minecraft:iron_pickaxe", " + recipeBook/recipes/minecraft:heavy_weighted_pressure_plate", " + recipeBook/recipes/minecraft:iron_boots", " + recipeBook/recipes/minecraft:iron_shovel", " + recipeBook/recipes/minecraft:minecart", " + recipeBook/recipes/minecraft:iron_door", " + recipeBook/toBeDisplayed/minecraft:iron_chestplate", " + recipeBook/toBeDisplayed/minecraft:shield", " + recipeBook/toBeDisplayed/minecraft:iron_leggings", " + recipeBook/toBeDisplayed/minecraft:iron_sword", " + recipeBook/toBeDisplayed/minecraft:shears", " + recipeBook/toBeDisplayed/minecraft:iron_bars", " + recipeBook/toBeDisplayed/minecraft:bucket", " + recipeBook/toBeDisplayed/minecraft:iron_helmet", " + recipeBook/toBeDisplayed/minecraft:iron_trapdoor", " + recipeBook/toBeDisplayed/minecraft:hopper", " + recipeBook/toBeDisplayed/minecraft:iron_hoe", " + recipeBook/toBeDisplayed/minecraft:iron_nugget", " + recipeBook/toBeDisplayed/minecraft:iron_axe", " + recipeBook/toBeDisplayed/minecraft:iron_pickaxe", " + recipeBook/toBeDisplayed/minecraft:heavy_weighted_pressure_plate", " + recipeBook/toBeDisplayed/minecraft:iron_boots", " + recipeBook/toBeDisplayed/minecraft:iron_shovel", " + recipeBook/toBeDisplayed/minecraft:minecart", " + recipeBook/toBeDisplayed/minecraft:iron_door", " - Inventory/Slot:24b:{Slot:24b,id:\"minecraft:log\",Count:1b,Damage:0s}", " + Inventory/Slot:16b:{Slot:16b,id:\"minecraft:planks\",Count:4b,Damage:0s}", " + Inventory/Slot:0b:{Slot:0b,id:\"minecraft:iron_ingot\",Count:2b,Damage:0s}", " + Inventory/Slot:13b:{Slot:13b,id:\"minecraft:wooden_button\",Count:1b,Damage:0s}", " - Inventory/Slot:14b/Count:2b", " + Inventory/Slot:14b/Count:1b", " - Rotation/[0]:-272.88077f", " + Rotation/[0]:-37.680817f", " - Rotation/[1]:21.150007f", " + Rotation/[1]:31.050005f");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }

    @Test
    public void testPlayerRecipeChanges6() throws Exception{
        String nbtprev = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068378588L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:wooden_sword\",\"minecraft:wooden_shovel\",\"minecraft:wooden_pressure_plate\",\"minecraft:wooden_pickaxe\",\"minecraft:wooden_hoe\",\"minecraft:wooden_door\",\"minecraft:wooden_button\",\"minecraft:wooden_axe\",\"minecraft:trapdoor\",\"minecraft:stick\",\"minecraft:sign\",\"minecraft:shield\",\"minecraft:shears\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:oak_planks\",\"minecraft:minecart\",\"minecraft:ladder\",\"minecraft:iron_trapdoor\",\"minecraft:iron_sword\",\"minecraft:iron_shovel\",\"minecraft:iron_pickaxe\",\"minecraft:iron_nugget\",\"minecraft:iron_leggings\",\"minecraft:iron_hoe\",\"minecraft:iron_helmet\",\"minecraft:iron_door\",\"minecraft:iron_chestplate\",\"minecraft:iron_boots\",\"minecraft:iron_bars\",\"minecraft:iron_axe\",\"minecraft:hopper\",\"minecraft:heavy_weighted_pressure_plate\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:crafting_table\",\"minecraft:bucket\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:wooden_sword\",\"minecraft:wooden_shovel\",\"minecraft:wooden_pickaxe\",\"minecraft:wooden_hoe\",\"minecraft:wooden_door\",\"minecraft:wooden_axe\",\"minecraft:trapdoor\",\"minecraft:sign\",\"minecraft:shield\",\"minecraft:shears\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:minecart\",\"minecraft:ladder\",\"minecraft:iron_trapdoor\",\"minecraft:iron_sword\",\"minecraft:iron_shovel\",\"minecraft:iron_pickaxe\",\"minecraft:iron_nugget\",\"minecraft:iron_leggings\",\"minecraft:iron_hoe\",\"minecraft:iron_helmet\",\"minecraft:iron_door\",\"minecraft:iron_chestplate\",\"minecraft:iron_boots\",\"minecraft:iron_bars\",\"minecraft:iron_axe\",\"minecraft:hopper\",\"minecraft:heavy_weighted_pressure_plate\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:bucket\"],isGuiOpen:1b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[-37.680817f,31.050005f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[92.52543569704686d,69.0d,254.41497603283773d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.01f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[{Slot:0b,id:\"minecraft:iron_ingot\",Count:2b,Damage:0s},{Slot:13b,id:\"minecraft:wooden_button\",Count:1b,Damage:0s},{Slot:14b,id:\"minecraft:planks\",Count:1b,Damage:0s},{Slot:16b,id:\"minecraft:planks\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:stick\",Count:4b,Damage:0s}],foodTickTimer:0}";
        String nbtnext = "{HurtByTimestamp:0,bukkit:{newLevel:0,newExp:0,newTotalExp:0,firstPlayed:1541068313805L,lastKnownName:\"stheu\",keepLevel:0b,expToDrop:0,lastPlayed:1541068383663L},SleepTimer:0s,Attributes:[{Base:20.0d,Name:\"generic.maxHealth\"},{Base:0.0d,Name:\"generic.knockbackResistance\"},{Base:0.10000000149011612d,Name:\"generic.movementSpeed\"},{Base:0.0d,Name:\"generic.armor\"},{Base:0.0d,Name:\"generic.armorToughness\"},{Base:1.0d,Name:\"generic.attackDamage\"},{Base:4.0d,Name:\"generic.attackSpeed\"},{Base:0.0d,Name:\"generic.luck\"}],Invulnerable:0b,FallFlying:0b,PortalCooldown:0,AbsorptionAmount:0.0f,abilities:{invulnerable:0b,mayfly:0b,instabuild:0b,walkSpeed:0.1f,mayBuild:1b,flying:0b,flySpeed:0.05f},FallDistance:0.0f,recipeBook:{recipes:[\"minecraft:wooden_sword\",\"minecraft:wooden_shovel\",\"minecraft:wooden_pressure_plate\",\"minecraft:wooden_pickaxe\",\"minecraft:wooden_hoe\",\"minecraft:wooden_door\",\"minecraft:wooden_button\",\"minecraft:wooden_axe\",\"minecraft:trapdoor\",\"minecraft:stick\",\"minecraft:sign\",\"minecraft:shield\",\"minecraft:shears\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:oak_planks\",\"minecraft:minecart\",\"minecraft:ladder\",\"minecraft:iron_trapdoor\",\"minecraft:iron_sword\",\"minecraft:iron_shovel\",\"minecraft:iron_pickaxe\",\"minecraft:iron_nugget\",\"minecraft:iron_leggings\",\"minecraft:iron_hoe\",\"minecraft:iron_helmet\",\"minecraft:iron_door\",\"minecraft:iron_chestplate\",\"minecraft:iron_boots\",\"minecraft:iron_bars\",\"minecraft:iron_axe\",\"minecraft:hopper\",\"minecraft:heavy_weighted_pressure_plate\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:crafting_table\",\"minecraft:bucket\"],isFilteringCraftable:0b,toBeDisplayed:[\"minecraft:wooden_sword\",\"minecraft:wooden_shovel\",\"minecraft:wooden_pickaxe\",\"minecraft:wooden_hoe\",\"minecraft:wooden_door\",\"minecraft:wooden_axe\",\"minecraft:trapdoor\",\"minecraft:sign\",\"minecraft:shield\",\"minecraft:oak_wooden_slab\",\"minecraft:oak_stairs\",\"minecraft:minecart\",\"minecraft:ladder\",\"minecraft:iron_sword\",\"minecraft:iron_shovel\",\"minecraft:iron_pickaxe\",\"minecraft:iron_leggings\",\"minecraft:iron_hoe\",\"minecraft:iron_helmet\",\"minecraft:iron_door\",\"minecraft:iron_chestplate\",\"minecraft:iron_boots\",\"minecraft:iron_bars\",\"minecraft:iron_axe\",\"minecraft:hopper\",\"minecraft:fence_gate\",\"minecraft:fence\",\"minecraft:bucket\"],isGuiOpen:1b},DeathTime:0s,XpSeed:0,WorldUUIDMost:614512722877891120L,XpTotal:0,playerGameType:0,seenCredits:0b,Motion:[0.0d,-0.0784000015258789d,0.0d],UUIDLeast:-7042360823602697849L,Health:20.0f,Bukkit.updateLevel:2,foodSaturationLevel:5.0f,Air:300s,OnGround:1b,Dimension:0,Rotation:[-59.880768f,25.050007f],XpLevel:0,Score:0,UUIDMost:1956384011718905599L,Sleeping:0b,Pos:[92.52543569704686d,69.0d,254.41497603283773d],Fire:-20s,XpP:0.0f,EnderItems:[],DataVersion:1343,foodLevel:20,foodExhaustionLevel:0.01f,HurtTime:0s,SelectedItemSlot:0,SpawnWorld:\"\",WorldUUIDLeast:-7572349821265110480L,Inventory:[{Slot:0b,id:\"minecraft:iron_ingot\",Count:2b,Damage:0s},{Slot:13b,id:\"minecraft:wooden_button\",Count:1b,Damage:0s},{Slot:14b,id:\"minecraft:planks\",Count:1b,Damage:0s},{Slot:16b,id:\"minecraft:planks\",Count:4b,Damage:0s},{Slot:21b,id:\"minecraft:stick\",Count:4b,Damage:0s}],foodTickTimer:0}";

        LinkedList<String> result = NbtDiffIterInventorySlotAndRecipeMod.diff(nbtprev, nbtnext, new LinkedList<>());
        System.out.println(result);

        Collections.sort(result);
        List<String> expected = Arrays.asList(" - bukkit/lastPlayed:1541068378588L", " + bukkit/lastPlayed:1541068383663L", " - recipeBook/toBeDisplayed/minecraft:shears", " - recipeBook/toBeDisplayed/minecraft:iron_trapdoor", " - recipeBook/toBeDisplayed/minecraft:iron_nugget", " - recipeBook/toBeDisplayed/minecraft:heavy_weighted_pressure_plate", " - Rotation/[0]:-37.680817f", " + Rotation/[0]:-59.880768f", " - Rotation/[1]:31.050005f", " + Rotation/[1]:25.050007f");
        Collections.sort(expected);
        Assert.assertArrayEquals(expected.toArray(), result.toArray());
    }
}
